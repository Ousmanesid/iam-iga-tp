<?xml version="1.0" encoding="UTF-8"?>
<!--
  Resource Definition: LDAP/Active Directory - Groupes gérés par MidPoint
  Cette ressource gère les groupes LDAP suivants :
  - Employee
  - Internet
  - Printer
  - Public_Share_Folder_SharePoint
-->
<resource oid="8a83b1a4-be18-11e6-ae84-7301fdab1d7e"
          xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
          xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3"
          xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
          xmlns:t="http://prism.evolveum.com/xml/ns/public/types-3"
          xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-3"
          xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance-3">

    <name>LDAP Groups</name>
    <description>Groupes LDAP gérés par MidPoint : Employee, Internet, Printer, Public_Share_Folder_SharePoint</description>

    <connectorRef type="ConnectorType">
        <filter>
            <q:equal>
                <q:path>connectorType</q:path>
                <q:value>com.evolveum.polygon.connector.ldap.LdapConnector</q:value>
            </q:equal>
        </filter>
    </connectorRef>

    <connectorConfiguration
            xmlns:icfc="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/connector-schema-3">
        <icfc:configurationProperties
                xmlns:icfcldap="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/bundle/com.evolveum.polygon.connector-ldap/com.evolveum.polygon.connector.ldap.LdapConnector">
            
            <icfcldap:host>openldap</icfcldap:host>
            <icfcldap:port>389</icfcldap:port>
            <icfcldap:baseContext>dc=example,dc=com</icfcldap:baseContext>
            <icfcldap:bindDn>cn=admin,dc=example,dc=com</icfcldap:bindDn>
            <icfcldap:bindPassword>
                <t:clearValue>admin</t:clearValue>
            </icfcldap:bindPassword>
            <icfcldap:connectionSecurity>none</icfcldap:connectionSecurity>
            
        </icfc:configurationProperties>
    </connectorConfiguration>

    <schemaHandling>
        <!-- Configuration pour les groupes LDAP -->
        <objectType>
            <kind>entitlement</kind>
            <intent>group</intent>
            <displayName>LDAP Group</displayName>
            <objectClass>ri:groupOfNames</objectClass>
            
            <attribute>
                <ref>ri:dn</ref>
                <outbound>
                    <strength>strong</strength>
                    <source>
                        <path>$focus/name</path>
                    </source>
                    <expression>
                        <script>
                            <code>import javax.naming.ldap.Rdn; return 'cn=' + Rdn.escapeValue(name.toString()) + ',ou=groups,dc=example,dc=com'</code>
                        </script>
                    </expression>
                </outbound>
            </attribute>
            
            <attribute>
                <ref>ri:cn</ref>
                <outbound>
                    <strength>strong</strength>
                    <source>
                        <path>$focus/name</path>
                    </source>
                </outbound>
            </attribute>
            
            <attribute>
                <ref>ri:description</ref>
                <outbound>
                    <strength>weak</strength>
                    <source>
                        <path>$focus/description</path>
                    </source>
                </outbound>
            </attribute>
            
            <!-- Association membre du groupe -->
            <association>
                <ref>ri:member</ref>
                <displayName>Group Member</displayName>
                <kind>entitlement</kind>
                <intent>group</intent>
                <direction>subjectToObject</direction>
                <associationAttribute>ri:member</associationAttribute>
                <valueAttribute>ri:dn</valueAttribute>
            </association>
            
        </objectType>
    </schemaHandling>

</resource>
